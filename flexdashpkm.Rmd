---
title: "Pokemon Analytics" 
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: fill
    orientation : rows 
    self_contained : TRUE
    logo: pikachu.jpg
    navbar:
       - { title: "Kaggle", href: "https://www.kaggle.com/datasets/rounakbanik/pokemon", align: right}
runtime: shiny
---




<style>

.navbar {
  background-color:#f0e51f;
  border-color:black;
  
}

.navbar-brand {
color:black!important;
}

.navbar-inverse .navbar-nav>li>a:focus {
    color: black;
    background-color: #f0e51f;
}

.navbar-inverse .navbar-nav>.active>a, .navbar-inverse .navbar-nav>.active>a:hover, .navbar-inverse .navbar-nav>.active>a:focus  {
    color: black;
    background-color: #f0e51f;
}

.navbar-inverse .navbar-nav>li>a {
    color: black;
    background-color: #f0e51f;
}

img{
     max-width:48px;
     max-height:48px;
}

.selectize-input {
    border: 1px solid #cfff02;
    padding: 7px 13px;
    display: inline-block;
    width: 75%;
    overflow: hidden;
    position: relative;
    z-index: 1;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-box-shadow: none;
    box-shadow: none;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 17px;
}

.navbar-brand {
    float: left;
    padding: 12.5px 38px;
    font-size: 20px;
    line-height: 22px;
    height: 45px;
}

</style>  




```{r setup, include=FALSE}

library(flexdashboard)
library(highcharter)
library(viridis)
library(ggplot2)
library(tidyverse)
library(shiny)
library(dplyr)
library(rlang)
library(broom)
library(RColorBrewer)
library(readxl)

df = read.csv('pokemon.csv')


txt = read_excel('values.xlsx', col_names =  T)






```

 
Grandes Rubros  
=========================================

Row {data-height=15%}
-------------------------------------


```{r}
# https://bookdown.org/koehlerj/qr_book/rcolorbrewer-and-barplots.html
# `r format(Sys.Date(), "%B %d, %Y")`

radioButtons(
  inputId = 'scatt',
  label = tags$strong('Scatter Plots'),
  choices = list('All' = 1,'Type' = 2), selected = 1,
  inline = TRUE,
  width = '400px')


selectInput(inputId = 'typepkm',
            label = tags$strong('Type'),
            choices = sort(unique(df$type1)), selected = "fire")



selectInput(inputId = 'xvalue',
            label = tags$strong('Variable X'),
            choices = sort(names(df[,c(20, 23, 26, 29, 34, 35, 36, 39)])), selected = "attack")


selectInput(inputId = 'yvalue',
            label = tags$strong('Variable Y'),
            choices = sort(names(df[,c(20, 23, 26,29, 34, 35, 36, 39)])), selected = "defense")


radioButtons(
  inputId = 'group',
  label = tags$strong('Agrupar'),
  choices = list('Type' = 'type1','Legendary' = 'is_legendary'), selected = 'type1',
  inline = TRUE,
  width = '400px')


radioButtons(
  inputId = 'reg',
  label = tags$strong('Regresion'),
  choices = list('Si' =  TRUE ,'No' = FALSE), selected = FALSE,
  inline = TRUE,
  width = '400px')


radioButtons(
  inputId = 'orden',
  label = tags$strong('Orden'),
  choices = c(1,2,3), selected = 1,
  inline = TRUE,
  width = '400px')


selectInput(inputId = 'colors',
            label = tags$strong('Themes'),
            choices = c('Spectral',
                        'Set2',
                        'Paired',
                        'Accent',
                        'Oranges',
                        'Reds',
                        'Purples',
                        'Dark2',
                        'PRGn',
                        'Set1'), 
            selected = 'PuRd')

```


Row {data-height=85%}
-------------------------------------

### Scatter Plot {data-width=52%}


```{r}

renderHighchart({
  
  
  xvar     <- input$xvalue
  yvar     <- input$yvalue
  groupvar <- input$group

    
  if (input$typepkm == 'grass'){
    coloresinp = '#59d97f'
  }
  else if (input$typepkm =='fire' ){
    coloresinp = '#d4193c'
  }
  else if (input$typepkm =='water' ){
    coloresinp = '#22a0bd'
  }
  else if (input$typepkm =='bug' ){
    coloresinp = '#00a650'
  }
  else if (input$typepkm =='normal' ){
    coloresinp = '#636b67'
  }
  else if (input$typepkm =='poison' ){
    coloresinp = '#320d54'
  }
  else if (input$typepkm =='electric' ){
    coloresinp = '#c7d92b'
  }
  else if (input$typepkm =='ground' ){
    coloresinp = 'a16d1a'
  }
  else if (input$typepkm =='fairy' ){
    coloresinp = '#f252c8'
  }
  else if (input$typepkm =='fighting' ){
    coloresinp = '#b09b5b'
  }
  else if (input$typepkm =='psychic' ){
    coloresinp = '#a8209d'
  }
  else if (input$typepkm =='rock' ){
    coloresinp = '#614707'
  }
  else if (input$typepkm =='ghost' ){
    coloresinp = '#d265d6'
  }
  else if (input$typepkm =='ice' ){
    coloresinp = '#1b8aa6'
  }
  else if (input$typepkm =='dragon' ){
    coloresinp = '#21a3ff'
  }
  else if (input$typepkm =='dark' ){
    coloresinp = '#1c1f1e'
  }
  else if (input$typepkm =='steel' ){
    coloresinp = '#616966'
  }
  else{
    coloresinp = '#5caebd'
  }
  
  if (input$scatt == 1){
    
    hc <-   df %>%
      hchart("scatter", hcaes(x = !!sym(xvar),
                              y = !!sym(yvar),
                              name = name,
                              group = !!sym(groupvar)),
             maxSize = "5%",
             regression = as.logical(input[['reg']]),
             regressionSettings = list(
                                  type = "polynomial",
                                  dashStyle = "ShortDash",
                                  order = as.numeric(input$orden),
                                  lineWidth = 5,
                                  name = "%eq | r2: %r",
                                  hideInLegend = TRUE)) %>%
      hc_tooltip(pointFormat = paste0("<b>Pokemon: {point.name} </b> <img src ='", colnames(txt) , "{point.pokedex_number}.png' width='100' height='120'>"),
                 useHTML = T) %>%  
      #hc_colors(c(coloresinp, '#f041c4')) %>%
      hc_add_dependency("plugins/highcharts-regression.js") %>%
      hc_add_theme(hc_theme_google()) %>% 
      hc_credits(enabled = TRUE, text = "Fuente: Kaggle",align = "right",verticalAlign = "bottom",
        style = list(color = "black", fontSize = '15px'),
        href = "https://www.kaggle.com/datasets/rounakbanik/pokemon") %>%
      hc_title(text = paste0('Scatter Plot - Linear Regression Order: ',input$orden),
         style = list(fontSize = '20px', fontWeight = 'bold'))
    
    hc
  
  
  }
  else if (input$scatt == 2){

      
    hc <-   df %>% filter(type1 == input$typepkm) %>% 
      hchart("scatter", hcaes(x = !!sym(xvar),
                              y = !!sym(yvar),
                              name = name,
                              group = !!sym(groupvar)),
             maxSize = "5%",
             regression = as.logical(input[['reg']]),
             regressionSettings = list(
                                  type = "polynomial",
                                  dashStyle = "ShortDash",
                                  order = as.numeric(input$orden),
                                  lineWidth = 5,
                                  name = "%eq | r2: %r",
                                  hideInLegend = TRUE)) %>%
      hc_tooltip(pointFormat = paste0("<b>Pokemon: {point.name} </b> <img src ='", colnames(txt) , "{point.pokedex_number}.png' width='100' height='120'>"),
                 useHTML = T) %>% 
      hc_colors(c(coloresinp, '#f041c4')) %>%
      hc_add_theme(hc_theme_google()) %>% 
      hc_add_dependency("plugins/highcharts-regression.js") %>%
      hc_credits(enabled = TRUE, text = "Fuente: Kaggle",align = "right",verticalAlign = "bottom",
        style = list(color = "black", fontSize = '15px'),
        href = "https://www.kaggle.com/datasets/rounakbanik/pokemon") %>%
      hc_title(text = paste0('Scatter Plot - Linear Regression Order: ',input$orden),
         style = list(fontSize = '20px', fontWeight = 'bold'))
    
    hc
      
    
    
  }



})

```

### Bar Plot {data-width=48%}



```{r}


renderHighchart({

  
  group_type = df %>% group_by(type1) %>% tally()
  
  
  bar_plots = group_type %>% 
    arrange(desc(n)) %>% 
    hchart('column', hcaes(x = type1, y = n),
           showInLegend = F,
           maxSize = "15%",
           dataLabels = list(enabled = TRUE,
                             format = '{point.y}')) %>% 
    hc_colorAxis(stops = color_stops(18, rev(RColorBrewer::brewer.pal(8, input$colors))))  %>% 
    hc_legend (enabled = FALSE) %>% 
    hc_tooltip(shared = FALSE, borderColor = "black", valueDecimals=0) %>%  
    hc_add_theme(hc_theme_google()) %>% 
    hc_tooltip(pointFormat = '<b>Total: </b> {point.y} <br> ' ) %>% 
    hc_title(text = 'Type Pokemon',
             style = list(fontSize = '20px', fontWeight = 'bold')) %>% 
    hc_subtitle(text = '<b>Bar Graph</b>',
                style = list(fontSize = '16px', color = "black")) %>% 
    hc_credits(enabled = TRUE, text = "Fuente: Kaggle",align = "right",verticalAlign = "bottom",
        style = list(color = "black", fontSize = '15px'),
        href = "https://www.kaggle.com/datasets/rounakbanik/pokemon") %>% 
    hc_yAxis(labels = list(style = list(color = "black")),
             tickColor = "black") %>% 
    hc_xAxis(labels = list(style = list(color = "black")),
             tickColor = "black") 
  
  bar_plots


})
  


```



<!-- Grandes Rubros 2 -->
<!-- ========================================= -->


<!-- Row {data-height=15%} -->
<!-- ------------------------------------- -->


<!-- ```{r} -->
<!-- # https://bookdown.org/koehlerj/qr_book/rcolorbrewer-and-barplots.html -->
<!-- #  -->



<!-- ``` -->





<!-- Row {data-height=10%} -->
<!-- ----------------------------------------------------------------------- -->

<!-- ### ***BarPlot***  -->



<!-- ```{r} -->




<!-- ``` -->


<!-- ### ***BarPlot***  -->


<!-- ```{r} -->


<!-- df %>%  -->
<!--   count(defense, type1) %>%  -->
<!--   hchart('areaspline', hcaes(x = 'defense', y = 'n', group = "type1")) -->

<!-- ``` -->


<!-- Row {data-height=60%} -->
<!-- ----------------------------------------------------------------------- -->

<!-- ### ***BoxPlot Edades por Sector***  {data-height=35%} -->


<!-- ```{r} -->

<!-- ``` -->



<!-- ### ***Pie Chart Genero***  {data-height=65%} -->


<!-- ```{r} -->



<!-- ``` -->


```{r}
# 
# hc <-   df %>%  
#       hchart("scatter", hcaes(x = defense,
#                               y = attack,
#                               name = name,
#                               group = type1),
#              maxSize = "5%",
#              regression = FALSE,
#              regressionSettings = list(
#                                   type = "polynomial",
#                                   dashStyle = "ShortDash",
#                                   order = 1,
#                                   lineWidth = 5,
#                                   name = "%eq | r2: %r",
#                                   hideInLegend = TRUE)) %>%
#       hc_tooltip(pointFormat = paste0("<b>Pokemon: {point.name} </b> <img src ='", colnames(txt) , "{point.pokedex_number}.png' width='100' height='120'>")
#                  useHTML = T) %>% 
#       hc_colors(c('#f041c4', '#f041c4')) %>%
#       hc_add_theme(hc_theme_google()) %>% 
#       hc_add_dependency("plugins/highcharts-regression.js") %>%
#       hc_credits(enabled = TRUE, text = "Fuente: Kaggle",align = "right",verticalAlign = "bottom",
#         style = list(color = "black", fontSize = '15px'),
#         href = "https://www.kaggle.com/datasets/rounakbanik/pokemon") %>%
#       hc_title(text = paste0('Scatter Plot - Linear Regression Order: '),
#          style = list(fontSize = '20px', fontWeight = 'bold'))
#     
# hc
# 
# 
# paste0("<b>Pokemon: {point.name} </b> <img src ='", colnames(txt) , "{point.pokedex_number}.png' width='100' height='120'>")
# 
```

